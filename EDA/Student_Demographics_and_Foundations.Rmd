---
title: "Student Demographics & Foundations"
output:
  html_document:
    df_print: paged
  pdf_document:
    latex_engine: xelatex
knitr:
  opts_chunk:
    echo: false
    warning: false
    message: false
    fig.path: figure/
---

## Setup & Data Import

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
libs<-c("dplyr","ggplot2","scales")
load_libraries<-function(libs){
new_libs <- libs[!(libs %in% installed.packages()[,"Package"])]
if(length(new_libs)>0) {install.packages(new_libs)}
lapply(libs, library, character.only = TRUE)
}
load_libraries(libs)

ws <- read.csv("../Data/TUMO Armenia Center Report_Workshops Statistics_Table.csv",
               stringsAsFactors=FALSE, na.strings=c("","NA")) %>%
  rename(Age=AgeTillStartDate) %>%
  mutate(TumoID=as.character(TumoID),
         Gender=factor(Gender),
         Age=as.numeric(Age))

si <- read.csv("../Data/TUMO Yerevan Center Report_Students List_Table - Sheet1.csv",
               stringsAsFactors=FALSE, na.strings=c("","NA")) %>%
  mutate(TumoID=as.character(TumoID),
         Classification=ifelse(is.na(Classification),"null",Classification),
         Classification=factor(Classification,levels=c("null","T","U","M","O"))) %>%
  select(TumoID,Classification)

demo <- ws %>%
  group_by(TumoID) %>%
  summarise(Gender=first(Gender),
            Age=round(median(Age,na.rm=TRUE)),
            .groups="drop") %>%
  left_join(si,by="TumoID") %>%
  filter(!is.na(Gender),!is.na(Age),!is.na(Classification))
```

## Overall Age Distribution

```{r plot-overall-age, fig.cap="Overall Age Distribution", echo=FALSE}
ggplot(demo, aes(x=Age)) +
  geom_histogram(binwidth=1, fill="#619CFF", color="white") +
  labs(title="Age Distribution of TUMO Students",
       x="Age (years)", y="Count") +
  theme_minimal()
```
```{r conlc-overall-age, echo=FALSE}

# Conclusion: Overall Age Distribution

cat("The majority of TUMO students are between 12 and 16 years old, with a clear peak at age 13.\n")
```

## Age Distribution by Gender

```{r plot-age-by-gender, fig.cap="Age Distribution by Gender", echo=FALSE}
ggplot(demo, aes(x=Age, fill=Gender)) +
  geom_histogram(binwidth=1, position="dodge", color="white") +
  labs(title="Age Distribution by Gender",
       x="Age (years)", y="Count") +
  theme_minimal()
```
```{r concl age-by-gender, echo=FALSE}

# Conclusion: Age Distribution by Gender

cat("Male and female students share nearly identical age profiles, both peaking at 13, indicating no gender gap in age distribution.\n")
```

## Student Classification Counts by Gender

```{r plot-class-by-gender, fig.cap="Student Classification Counts by Gender", echo=FALSE}
ggplot(demo, aes(x=Classification, fill=Gender)) +
  geom_bar(position="dodge") +
  geom_text(stat="count", aes(label=after_stat(count)),
            position=position_dodge(width=0.9),
            vjust=-0.5, size=3) +
  labs(title="Student Classification Counts by Gender",
       x="Classification", y="Count") +
  theme_minimal()
```
```{r concl-class-by-gender, echo=FALSE}

# Conclusion: Student Classification Counts by Gender

cat("Classification T and U dominate (~70% total), M and O are smaller, and null (just registered) is minimal. Both genders follow the same pattern.\n")

```

## Boxplot of Age per Classification

```{r plot-boxplot-age-class, fig.cap="Boxplot of Age by Classification", echo=FALSE}
ggplot(demo, aes(x=Classification, y=Age, fill=Classification)) +
  geom_boxplot(outlier.shape=21, outlier.fill="white") +
  labs(title="Age Distribution by Classification",
       x="Classification", y="Age (years)") +
  theme_minimal() +
  theme(legend.position="none")
```

```{r concl-boxplot-age-class, echo=FALSE}

# Conclusion: Boxplot of Age by Classification

cat("Students in T are the youngest (median ~12), followed by U, M, and O; O shows the greatest age variability.\n")
```

## Age by Classification & Gender


```{r plot-violon-jitter, fig.cap="Violin + Jitter: Age by Classification & Gender", echo=FALSE}
ggplot(demo, aes(x=Classification, y=Age, fill=Gender)) +
  geom_violin(alpha=0.6, position=position_dodge(0.8)) +
  geom_jitter(aes(color=Gender),
              position=position_dodge(0.8),
              size=1, alpha=0.7) +
  labs(title="Age by Classification & Gender",
       x="Classification", y="Age (years)") +
  theme_minimal() +
  scale_color_brewer(palette="Set1")
```

```{r concl-violin-jitter, echo=FALSE}

# Conclusion: Violin + Jitter: Age by Classification & Gender

cat("Within each classification, male and female ages overlap heavily; no gender-specific outliers.\n")
```

# Age Density by Gender

```{r plot-density-age-gender, fig.cap="Age Density by Gender", echo=FALSE}
ggplot(demo, aes(x=Age, fill=Gender)) +
  geom_density(alpha=0.5) +
  facet_wrap(~Gender) +
  labs(title="Smoothed Age Density by Gender",
       x="Age (years)", y="Density") +
  theme_minimal()
```
```{r concl-density-age-gender, echo=FALSE}

# Conclusion: Age Density by Gender

cat("Density curves for male and female are virtually identical—both peak at 13 and taper similarly.\n")
```

# A/B Test — Mean Age of T vs. U

```{r ab-test, echo=FALSE}
ab_data <- demo %>% filter(Classification %in% c("T","U"))
t_test <- t.test(Age ~ Classification, data=ab_data)
print(t_test)
```

```{r concl-aab-test, echo=FALSE}

# Conclusion: A/B Test — Mean Age of T vs. U

cat("The t-test comparing mean ages of T (~12.8) vs. U (~13.1) yields p < 0.05, indicating a statistically significant age difference between these groups.\n")
```

